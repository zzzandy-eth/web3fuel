{% extends "base.html" %}

{% block content %}
<div class="global-spotlight"></div>

<!-- Hero Section -->
<section class="hero">
    <div class="hero-bg">
        <img src="{{ url_for('static', filename='images/creation-of-blockchain.jpg') }}" alt="" class="hero-bg-base">
        <img src="{{ url_for('static', filename='images/creation-of-blockchain.jpg') }}" alt="" class="hero-bg-bright">
    </div>
    <div class="container">
        <div class="hero-centered">
            <h1>Advancing Blockchain<br>Infrastructure &<br>Smart Contract <span class="hero-accent">Security</span></h1>
            <p class="hero-subtitle">Fueling Web3 development through protocol security and cross-chain interoperability.<br>Breaking down complex systems and building tools for the multi-chain ecosystem.</p>
        </div>

        <!-- Hero stats spanning full width -->
        <div class="hero-stats">
            <div class="stat-card">
                <div class="stat-value">15+</div>
                <div class="stat-label">Protocols Analyzed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">$2.8B+</div>
                <div class="stat-label">Bridge Hacks Studied</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">8</div>
                <div class="stat-label">Blockchains Monitored</div>
            </div>
        </div>
    </div>
</section>

<!-- Latest Protocol Analysis Section -->
<section class="services-section">
    <div class="container">
        <h2 class="latest-analysis-title">Latest Research & Tutorials</h2>
        <p class="latest-analysis-subtitle">Deep dives into bridge security, multi-chain protocols, and cross-chain infrastructure development.</p>

        <div class="blog-section-wrapper">
            <div class="carousel-container" id="researchCarousel">
                <button class="carousel-nav-btn carousel-nav-prev" data-carousel="researchCarousel">&lt;&lt;</button>
                <div class="carousel-viewport">
                <div class="carousel-track">
                    {% for post in recent_posts %}
                    <a href="{{ post.link }}" target="_blank" rel="noopener noreferrer" class="blog-card-link carousel-item">
                        <article class="blog-card">
                            {% if post.featured_image %}
                            <div class="blog-card-image">
                                <img src="{{ post.featured_image }}" alt="{{ post.title }}">
                            </div>
                            {% endif %}
                            <h3 class="blog-card-title">{{ post.title }}</h3>
                            <p class="blog-card-excerpt">{{ post.excerpt }}</p>
                            <div class="blog-card-meta">
                                <span class="blog-card-category">
                                    {% if post.categories %}{{ post.categories[0].name }}{% else %}Research{% endif %}
                                </span>
                                <span class="blog-card-readtime">üïê {{ post.reading_time }} min read</span>
                            </div>
                        </article>
                    </a>
                    {% else %}
                    <p class="no-posts-message">No articles available at this time.</p>
                    {% endfor %}
                </div>
                </div>
                <button class="carousel-nav-btn carousel-nav-next" data-carousel="researchCarousel">&gt;&gt;</button>
            </div>

            <a href="/blog" target="_blank" rel="noopener noreferrer" class="view-all-btn view-all-link-btn">
                <span class="btn-default">>></span>
                <span class="btn-hover">View All Research</span>
            </a>

            <a href="/blog" target="_blank" rel="noopener noreferrer" class="view-all-centered-btn">View All Research</a>
        </div>
    </div>
</section>

<!-- Tools & Applications Section -->
<section class="tools-apps-section">
    <div class="container">
        <h2 class="latest-analysis-title">Tools & Applications</h2>
        <p class="latest-analysis-subtitle">Live dashboards and interactive tools for cross-chain analysis, portfolio tracking, and security monitoring.</p>

        <div class="blog-section-wrapper">
            <div class="carousel-container" id="toolsCarousel">
                <button class="carousel-nav-btn carousel-nav-prev" data-carousel="toolsCarousel">&lt;&lt;</button>
                <div class="carousel-viewport">
                <div class="carousel-track">
                    {% for tool in recent_tools %}
                    <a href="{{ url_for('tools.tool', slug=tool.slug) }}" target="_blank" rel="noopener noreferrer" class="blog-card-link carousel-item">
                        <article class="blog-card">
                            <h3 class="blog-card-title">{{ tool.title }}</h3>
                            <p class="blog-card-excerpt">{{ tool.description|truncate(200, True, '...') }}</p>
                            <div class="blog-card-meta">
                                <span class="blog-card-category">
                                    {% if tool.tags %}{{ tool.tags[0] }}{% else %}Tool{% endif %}
                                </span>
                                <span class="blog-card-readtime {% if tool.status == 'live' %}tool-status-live{% else %}tool-status-soon{% endif %}">
                                    {% if tool.status == 'live' %}Live{% else %}Coming Soon{% endif %}
                                </span>
                            </div>
                        </article>
                    </a>
                    {% else %}
                    <p class="no-posts-message">No tools available at this time.</p>
                    {% endfor %}
                </div>
                </div>
                <button class="carousel-nav-btn carousel-nav-next" data-carousel="toolsCarousel">&gt;&gt;</button>
            </div>

            <a href="/tools" target="_blank" rel="noopener noreferrer" class="view-all-btn view-all-link-btn">
                <span class="btn-default">>></span>
                <span class="btn-hover">View All Tools</span>
            </a>

            <a href="/tools" target="_blank" rel="noopener noreferrer" class="view-all-centered-btn">View All Tools</a>
        </div>
    </div>
</section>

<!-- The Mission Section -->
<section class="core-expertise-section">
    <div class="container">
        <h2 class="latest-analysis-title">The Mission</h2>

        <!-- About Blurb -->
        <div class="about-blurb">
            <div class="about-image">
                <img src="{{ url_for('static', filename='images/profile.png') }}" alt="Alex - Web3Fuel Founder">
            </div>
            <div class="about-text">
                <p>Hi, my name is Alex. I started Web3Fuel after one too many "How did that bridge get hacked?" moments. As a DeFi user, I was also tired of crossing my fingers every time I bridged assets, so I decided to actually understand the infrastructure.</p>
                <p>Turns out, most bridge hacks follow predictable patterns. Most security issues are preventable. And most documentation assumes you already know what you're trying to learn.</p>
                <p>Web3Fuel exists to change that by analyzing protocols, documenting vulnerabilities, and creating resources that help developers and users navigate cross-chain infrastructure with confidence, not hope.</p>
            </div>
        </div>

        <p class="latest-analysis-subtitle">Skills & Core Expertise</p>

        <div class="expertise-cards-grid">
            <!-- Card 1: Cross-Chain Infrastructure -->
            <div class="expertise-card expertise-card-1">
                <h3 class="expertise-card-title">Cross-Chain Infrastructure & Interoperability</h3>
                <p class="expertise-card-description">Bridge security analysis, cross-chain messaging protocols, and multi-chain architecture. Analyzing trust models, validator networks, and consensus mechanisms.</p>
                <ul class="expertise-list">
                    <li>Bridge security audits & risk assessment</li>
                    <li>Cross-chain messaging protocol analysis</li>
                    <li>Multi-chain integration patterns</li>
                    <li>Validator & relayer network evaluation</li>
                </ul>
            </div>

            <!-- Card 2: Smart Contract Security -->
            <div class="expertise-card expertise-card-2">
                <h3 class="expertise-card-title">Smart Contract Security & Vulnerability Research</h3>
                <p class="expertise-card-description">Exploit analysis, vulnerability documentation, and security best practices. Breaking down bridge hacks and DeFi exploits to identify common attack vectors and prevention strategies.</p>
                <ul class="expertise-list">
                    <li>Exploit case studies & post-mortems</li>
                    <li>Vulnerability patterns</li>
                    <li>Security audit methodology</li>
                    <li>Attack vector documentation</li>
                </ul>
            </div>

            <!-- Card 3: Protocol Architecture -->
            <div class="expertise-card expertise-card-3">
                <h3 class="expertise-card-title">Protocol Architecture & Development</h3>
                <p class="expertise-card-description">Deep-dive analysis of protocol design patterns, economic models, and technical implementation. Simplifying how decentralized systems are built and secured.</p>
                <ul class="expertise-list">
                    <li>Protocol design pattern analysis</li>
                    <li>Economic incentive structures</li>
                    <li>Technical documentation & tutorials</li>
                    <li>Developer tooling & integration guides</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta" id="contact">
    <div class="container">
        <div class="cta-container">
            <div class="cta-content">
                <div class="cta-text">
                    <h2 class="cta-title">Ready to Collaborate on <br>Cross-Chain Infrastructure?</h2>
                    <p class="cta-description">Whether you're looking for research insights, tool development, or consulting on cross-chain strategy, let's discuss how we can work together to build better infrastructure.</p>
                </div>
                
                <div class="contact-form">
                    <form id="contactForm" onsubmit="sendEmail(event)">
                        <div class="form-group">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" id="name" name="name" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                        </div>


                        <div class="appointment-toggle">
                            <input type="checkbox" id="appointmentToggle" class="toggle-checkbox" onchange="toggleAppointmentFields()">
                            <label for="appointmentToggle" class="toggle-label">Schedule a call to discuss</label>
                        </div>

                        <!-- Appointment Fields (Hidden by default) -->
                        <div class="appointment-fields" id="appointmentFields">
                            <div class="appointment-header">üìÖ Schedule Your Call</div>
                            <div class="form-group">
                                <label for="datetime" class="form-label">Preferred Date & Time (EST)</label>
                                <input type="datetime-local" id="datetime" name="datetime" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="message" class="form-label">Message</label>
                            <textarea id="message" name="message" class="form-input form-textarea" required></textarea>
                        </div>
                        
                        <button type="submit" class="form-submit">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Global Spotlight Effect (homepage only - hidden in hero section)
        const spotlight = document.querySelector('.global-spotlight');
        const heroSection = document.querySelector('.hero');

        if (spotlight) {
            document.addEventListener('mousemove', (e) => {
                // Check if cursor is inside hero section
                if (heroSection) {
                    const heroRect = heroSection.getBoundingClientRect();
                    const isInHero = e.clientY >= heroRect.top && e.clientY <= heroRect.bottom;

                    if (isInHero) {
                        // Hide spotlight in hero (hero has its own effect)
                        spotlight.style.opacity = '0';
                    } else {
                        spotlight.style.opacity = '1';
                        spotlight.style.setProperty('--mouse-x', `${e.clientX}px`);
                        spotlight.style.setProperty('--mouse-y', `${e.clientY}px`);
                    }
                } else {
                    spotlight.style.setProperty('--mouse-x', `${e.clientX}px`);
                    spotlight.style.setProperty('--mouse-y', `${e.clientY}px`);
                }
            });

            document.addEventListener('mouseleave', () => {
                spotlight.style.setProperty('--mouse-x', '-200px');
                spotlight.style.setProperty('--mouse-y', '-200px');
            });
        }

        // Hero spotlight effect (disabled below stat cards)
        const hero = document.querySelector('.hero');
        const heroBgBright = document.querySelector('.hero-bg-bright');
        const heroStats = document.querySelector('.hero-stats');

        if (hero && heroBgBright) {
            hero.addEventListener('mousemove', (e) => {
                // Disable spotlight 5px below stat cards
                if (heroStats) {
                    const statsRect = heroStats.getBoundingClientRect();
                    if (e.clientY > statsRect.bottom + 5) {
                        heroBgBright.style.setProperty('--spotlight-x', '-200px');
                        heroBgBright.style.setProperty('--spotlight-y', '-200px');
                        return;
                    }
                }

                const rect = hero.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                heroBgBright.style.setProperty('--spotlight-x', `${x}px`);
                heroBgBright.style.setProperty('--spotlight-y', `${y}px`);
            });

            hero.addEventListener('mouseleave', () => {
                heroBgBright.style.setProperty('--spotlight-x', '-200px');
                heroBgBright.style.setProperty('--spotlight-y', '-200px');
            });
        }

        // Set minimum date to today for datetime picker
        const datetimeInput = document.getElementById('datetime');
        if (datetimeInput) {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            datetimeInput.min = now.toISOString().slice(0, 16);
        }

        // Store carousel controls for button access
        const carouselControls = {};

        // Initialize carousels with step-based rotation (only on screens >= 1500px)
        function initCarousel(carouselId, intervalMs = 8000) {
            const carousel = document.getElementById(carouselId);
            if (!carousel) return;

            const track = carousel.querySelector('.carousel-track');
            if (!track) return;

            const items = Array.from(track.querySelectorAll('.carousel-item'));
            if (items.length <= 1) return;

            let currentIndex = 0;
            let intervalId = null;
            let isInitialized = false;
            const totalItems = items.length;

            function isCarouselEnabled() {
                return window.innerWidth >= 1500;
            }

            function cloneItems() {
                if (isInitialized) return;
                items.forEach(item => {
                    const clone = item.cloneNode(true);
                    clone.classList.add('carousel-clone');
                    track.appendChild(clone);
                });
                isInitialized = true;
            }

            function removeClones() {
                if (!isInitialized) return;
                track.querySelectorAll('.carousel-clone').forEach(clone => clone.remove());
                isInitialized = false;
            }

            function getItemWidth() {
                const item = track.querySelector('.carousel-item');
                if (!item) return 0;
                const style = getComputedStyle(track);
                const gap = parseFloat(style.gap) || 32;
                return item.offsetWidth + gap;
            }

            function slideTo(index) {
                if (!isCarouselEnabled()) return;
                const itemWidth = getItemWidth();
                track.style.transform = `translateX(-${index * itemWidth}px)`;
            }

            function slideNext() {
                if (!isCarouselEnabled()) return;
                resetAutoplay();
                currentIndex++;
                slideTo(currentIndex);

                if (currentIndex >= totalItems) {
                    setTimeout(() => {
                        track.style.transition = 'none';
                        currentIndex = 0;
                        track.style.transform = 'translateX(0)';
                        track.offsetHeight;
                        track.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1)';
                    }, 800);
                }
            }

            function slidePrev() {
                if (!isCarouselEnabled()) return;
                resetAutoplay();
                if (currentIndex === 0) {
                    // Jump to end instantly, then animate back
                    track.style.transition = 'none';
                    currentIndex = totalItems;
                    slideTo(currentIndex);
                    track.offsetHeight;
                    track.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1)';
                }
                currentIndex--;
                slideTo(currentIndex);
            }

            function resetAutoplay() {
                stopAutoplay();
                startAutoplay();
            }

            function startAutoplay() {
                if (intervalId || !isCarouselEnabled()) return;
                intervalId = setInterval(slideNext, intervalMs);
            }

            function stopAutoplay() {
                if (intervalId) {
                    clearInterval(intervalId);
                    intervalId = null;
                }
            }

            function enableCarousel() {
                cloneItems();
                startAutoplay();
            }

            function disableCarousel() {
                stopAutoplay();
                removeClones();
                currentIndex = 0;
                track.style.transition = 'none';
                track.style.transform = 'translateX(0)';
            }

            // Pause on hover
            carousel.addEventListener('mouseenter', stopAutoplay);
            carousel.addEventListener('mouseleave', () => {
                if (isCarouselEnabled()) startAutoplay();
            });

            // Handle window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    if (isCarouselEnabled() && !isInitialized) {
                        enableCarousel();
                    } else if (!isCarouselEnabled() && isInitialized) {
                        disableCarousel();
                    } else if (isCarouselEnabled()) {
                        track.style.transition = 'none';
                        currentIndex = 0;
                        track.style.transform = 'translateX(0)';
                        setTimeout(() => {
                            track.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1)';
                        }, 50);
                    }
                }, 100);
            });

            // Initial setup
            if (isCarouselEnabled()) {
                enableCarousel();
            }

            // Store controls for button access
            carouselControls[carouselId] = { slideNext, slidePrev };
        }

        initCarousel('researchCarousel', 8000);
        initCarousel('toolsCarousel', 8000);

        // Set up navigation button click handlers
        document.querySelectorAll('.carousel-nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const carouselId = btn.dataset.carousel;
                const controls = carouselControls[carouselId];
                if (!controls) return;

                if (btn.classList.contains('carousel-nav-prev')) {
                    controls.slidePrev();
                } else if (btn.classList.contains('carousel-nav-next')) {
                    controls.slideNext();
                }
            });
        });
    });

    // Toggle appointment fields
    function toggleAppointmentFields() {
        const checkbox = document.getElementById('appointmentToggle');
        const fields = document.getElementById('appointmentFields');
        const datetimeInput = document.getElementById('datetime');
        
        if (checkbox.checked) {
            fields.classList.add('show');
            datetimeInput.required = true;
            
            // Set minimum date to today for datetime picker
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            datetimeInput.min = now.toISOString().slice(0, 16);
        } else {
            fields.classList.remove('show');
            datetimeInput.required = false;
            datetimeInput.value = '';
        }
    }

    // Alert Functions
    function showAlert(message, type) {
        const alertContainer = document.getElementById('alert-container');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type} show`;
        alert.textContent = message;
        
        alertContainer.innerHTML = '';
        alertContainer.appendChild(alert);
        
        setTimeout(() => {
            alert.classList.remove('show');
            setTimeout(() => alertContainer.innerHTML = '', 300);
        }, 5000);
    }
    
    // Contact form submission
    function sendEmail(event) {
        event.preventDefault();
        
        const submitBtn = document.getElementById('submitBtn');
        const originalText = submitBtn.textContent;
        
        // Disable button and show loading state
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        
        // Initialize EmailJS with your public key
        emailjs.init("xSYgQUruN6qY2C0o2");
        
        // Check if appointment is requested
        const appointmentRequested = document.getElementById('appointmentToggle').checked;
        let estDateTime = 'No appointment requested';
        
        if (appointmentRequested) {
            const datetimeInput = document.getElementById('datetime').value;
            if (datetimeInput) {
                const selectedDate = new Date(datetimeInput);
                estDateTime = selectedDate.toLocaleString("en-US", {
                    timeZone: "America/New_York",
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                }) + " EST";
            }
        }
        
        const params = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            inquiry_type: 'Cross-Chain Infrastructure Inquiry',
            message: document.getElementById('message').value,
            appointment_requested: appointmentRequested ? 'Yes' : 'No',
            preferred_datetime: estDateTime
        };
        
        // Send email
        emailjs.send("service_gf8ewl9", "template_nad2dyc", params)
            .then(() => {
                if (appointmentRequested) {
                    showAlert("Thanks for your message and appointment request! We'll get back to you within 24 hours with a meeting invite.", 'success');
                } else {
                    showAlert("Thanks for your message! We'll get back to you within 24 hours.", 'success');
                }
                document.getElementById('contactForm').reset();
                document.getElementById('appointmentFields').classList.remove('show');
            })
            .catch((error) => {
                console.error('Error:', error);
                showAlert("Sorry, there was an error sending your message. Please try again.", 'error');
            })
            .finally(() => {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
{% endblock %}