{% extends "base.html" %}

{% block content %}
<div class="global-spotlight"></div>

<!-- Hero Section -->
<section class="hero">
    <div class="hero-bg">
        <img src="{{ url_for('static', filename='images/creation-of-blockchain.jpg') }}" alt="" class="hero-bg-base">
        <img src="{{ url_for('static', filename='images/creation-of-blockchain.jpg') }}" alt="" class="hero-bg-bright">
    </div>
    <div class="container">
        <div class="hero-centered">
            <h1>Advancing Blockchain<br>Infrastructure &<br>Smart Contract <span class="hero-accent">Security</span></h1>
            <p class="hero-subtitle">Fueling Web3 development through protocol security and cross-chain interoperability.<br>Breaking down complex systems and building tools for the multi-chain ecosystem.</p>
        </div>

        <!-- Hero stats spanning full width -->
        <div class="hero-stats">
            <div class="stat-card">
                <div class="stat-value">15+</div>
                <div class="stat-label">Protocols Analyzed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">$2.8B+</div>
                <div class="stat-label">Bridge Hacks Studied</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">8</div>
                <div class="stat-label">Blockchains Monitored</div>
            </div>
        </div>
    </div>
</section>

<!-- Latest Protocol Analysis Section -->
<section class="services-section">
    <div class="container">
        <h2 class="latest-analysis-title">Latest Protocol Analysis</h2>
        <p class="latest-analysis-subtitle">Analysis on bridge security, multi-chain protocols, and cross-chain infrastructure development.</p>

        <div class="blog-cards-grid">
            {% for post in recent_posts %}
            <a href="{{ post.link }}" target="_blank" rel="noopener noreferrer" class="blog-card-link">
                <article class="blog-card">
                    <h3 class="blog-card-title">{{ post.title }}</h3>
                    <p class="blog-card-excerpt">{{ post.excerpt }}</p>
                    <div class="blog-card-meta">
                        <span class="blog-card-category">
                            {% if post.categories %}{{ post.categories[0].name }}{% else %}Research{% endif %}
                        </span>
                        <span class="blog-card-readtime">üïê {{ post.reading_time }} min read</span>
                    </div>
                </article>
            </a>
            {% else %}
            <p class="no-posts-message">No articles available at this time.</p>
            {% endfor %}
        </div>

        <div class="view-all-research">
            <a href="/blog" class="view-all-btn">View All Research</a>
        </div>
    </div>
</section>

<!-- Cross-Chain Infrastructure Expertise Section -->
<section class="cross-chain-expertise-section">
    <div class="container">
        <h2 class="cross-chain-expertise-title">Cross-Chain Infrastructure Expertise</h2>
        <p class="cross-chain-expertise-subtitle">Deep understanding of bridge security, protocol architecture, <br>and the challenges of building truly decentralized infrastructure.</p>
        
        <div class="cross-chain-solutions-grid">
            <!-- Bridge Security Analysis -->
            <div class="solution-category bridge-security-category">
                <div class="solution-header">
                    <span class="solution-icon">üõ°Ô∏è</span>
                    <h3 class="solution-title">Bridge Security Analysis</h3>
                </div>
                <div class="solution-items">
                    <div class="solution-item">
                        <div class="solution-item-icon">üîç</div>
                        <div class="solution-item-content">
                            <h4>Security Audits</h4>
                            <p>Comprehensive analysis of bridge architectures and trust assumptions</p>
                        </div>
                    </div>
                    <div class="solution-item">
                        <div class="solution-item-icon">üìä</div>
                        <div class="solution-item-content">
                            <h4>Risk Assessment</h4>
                            <p>Quantitative risk scoring based on TVL, validator sets, and history</p>
                        </div>
                    </div>
                    <div class="solution-item">
                        <div class="solution-item-icon">‚ö†Ô∏è</div>
                        <div class="solution-item-content">
                            <h4>Vulnerability Research</h4>
                            <p>Analysis of past bridge hacks and common attack vectors</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Infrastructure Development -->
            <div class="solution-category protocol-analysis-category">
                <div class="solution-header">
                    <span class="solution-icon">üèóÔ∏è</span>
                    <h3 class="solution-title">Infrastructure Development</h3>
                </div>
                <div class="solution-items">
                    <div class="solution-item">
                        <div class="solution-item-icon">üîß</div>
                        <div class="solution-item-content">
                            <h4>Tool Development</h4>
                            <p>Building practical tools for cross-chain users, developers, and researchers</p>
                        </div>
                    </div>
                    <div class="solution-item">
                        <div class="solution-item-icon">üìà</div>
                        <div class="solution-item-content">
                            <h4>Analytics Platforms</h4>
                            <p>Data visualization and monitoring for multi-chain protocols and networks</p>
                        </div>
                    </div>
                    <div class="solution-item">
                        <div class="solution-item-icon">üåê</div>
                        <div class="solution-item-content">
                            <h4>Protocol Integration</h4>
                            <p>Smart contract development and cross-chain implementation</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Split-Screen Comparison -->
        <div class="comparison-grid">
            <!-- Research Impact -->
            <div class="comparison-card cross-chain-tools">
                <div class="comparison-header">
                    <span class="comparison-badge">Research Impact</span>
                </div>
                <p class="comparison-quote">"Analyzed 15 major bridges and uncovered common security patterns that led to $2.8B in losses"</p>
                <p class="comparison-result">‚Üí Result: 47-page security framework helping users choose safer bridges</p>
                
                <ul class="feature-list">
                    <li>Comprehensive bridge database</li>
                    <li>Risk scoring methodology</li>
                    <li>Real-world vulnerability analysis</li>
                </ul>
            </div>
            
            <!-- Tool Development -->
            <div class="comparison-card research-insights">
                <div class="comparison-header">
                    <span class="comparison-badge">Tool Development</span>
                </div>
                <p class="comparison-quote">"Built bridge fee tracker showing users can save 60%+ by choosing optimal routes"</p>
                <p class="comparison-result">‚Üí Result: Helping users save thousands in unnecessary bridge fees</p>
                
                <ul class="feature-list">
                    <li>Real-time fee comparison</li>
                    <li>Multi-chain portfolio tracking</li>
                    <li>Transaction monitoring dashboard</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta" id="contact">
    <div class="container">
        <div class="cta-container">
            <div class="cta-content">
                <div class="cta-text">
                    <h2 class="cta-title">Ready to Collaborate on <br>Cross-Chain Infrastructure?</h2>
                    <p class="cta-description">Whether you're looking for research insights, tool development, or consulting on cross-chain strategy, let's discuss how we can work together to build better infrastructure.</p>
                </div>
                
                <div class="contact-form">
                    <form id="contactForm" onsubmit="sendEmail(event)">
                        <div class="form-group">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" id="name" name="name" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                        </div>


                        <div class="appointment-toggle">
                            <input type="checkbox" id="appointmentToggle" class="toggle-checkbox" onchange="toggleAppointmentFields()">
                            <label for="appointmentToggle" class="toggle-label">Schedule a call to discuss</label>
                        </div>

                        <!-- Appointment Fields (Hidden by default) -->
                        <div class="appointment-fields" id="appointmentFields">
                            <div class="appointment-header">üìÖ Schedule Your Call</div>
                            <div class="form-group">
                                <label for="datetime" class="form-label">Preferred Date & Time (EST)</label>
                                <input type="datetime-local" id="datetime" name="datetime" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="message" class="form-label">Message</label>
                            <textarea id="message" name="message" class="form-input form-textarea" required></textarea>
                        </div>
                        
                        <button type="submit" class="form-submit">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Global Spotlight Effect (homepage only - hidden in hero section)
        const spotlight = document.querySelector('.global-spotlight');
        const heroSection = document.querySelector('.hero');

        if (spotlight) {
            document.addEventListener('mousemove', (e) => {
                // Check if cursor is inside hero section
                if (heroSection) {
                    const heroRect = heroSection.getBoundingClientRect();
                    const isInHero = e.clientY >= heroRect.top && e.clientY <= heroRect.bottom;

                    if (isInHero) {
                        // Hide spotlight in hero (hero has its own effect)
                        spotlight.style.opacity = '0';
                    } else {
                        spotlight.style.opacity = '1';
                        spotlight.style.setProperty('--mouse-x', `${e.clientX}px`);
                        spotlight.style.setProperty('--mouse-y', `${e.clientY}px`);
                    }
                } else {
                    spotlight.style.setProperty('--mouse-x', `${e.clientX}px`);
                    spotlight.style.setProperty('--mouse-y', `${e.clientY}px`);
                }
            });

            document.addEventListener('mouseleave', () => {
                spotlight.style.setProperty('--mouse-x', '-200px');
                spotlight.style.setProperty('--mouse-y', '-200px');
            });
        }

        // Hero spotlight effect (disabled below stat cards)
        const hero = document.querySelector('.hero');
        const heroBgBright = document.querySelector('.hero-bg-bright');
        const heroStats = document.querySelector('.hero-stats');

        if (hero && heroBgBright) {
            hero.addEventListener('mousemove', (e) => {
                // Disable spotlight 5px below stat cards
                if (heroStats) {
                    const statsRect = heroStats.getBoundingClientRect();
                    if (e.clientY > statsRect.bottom + 5) {
                        heroBgBright.style.setProperty('--spotlight-x', '-200px');
                        heroBgBright.style.setProperty('--spotlight-y', '-200px');
                        return;
                    }
                }

                const rect = hero.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                heroBgBright.style.setProperty('--spotlight-x', `${x}px`);
                heroBgBright.style.setProperty('--spotlight-y', `${y}px`);
            });

            hero.addEventListener('mouseleave', () => {
                heroBgBright.style.setProperty('--spotlight-x', '-200px');
                heroBgBright.style.setProperty('--spotlight-y', '-200px');
            });
        }

        // Set minimum date to today for datetime picker
        const datetimeInput = document.getElementById('datetime');
        if (datetimeInput) {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            datetimeInput.min = now.toISOString().slice(0, 16);
        }
    });

    // Toggle appointment fields
    function toggleAppointmentFields() {
        const checkbox = document.getElementById('appointmentToggle');
        const fields = document.getElementById('appointmentFields');
        const datetimeInput = document.getElementById('datetime');
        
        if (checkbox.checked) {
            fields.classList.add('show');
            datetimeInput.required = true;
            
            // Set minimum date to today for datetime picker
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            datetimeInput.min = now.toISOString().slice(0, 16);
        } else {
            fields.classList.remove('show');
            datetimeInput.required = false;
            datetimeInput.value = '';
        }
    }

    // Alert Functions
    function showAlert(message, type) {
        const alertContainer = document.getElementById('alert-container');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type} show`;
        alert.textContent = message;
        
        alertContainer.innerHTML = '';
        alertContainer.appendChild(alert);
        
        setTimeout(() => {
            alert.classList.remove('show');
            setTimeout(() => alertContainer.innerHTML = '', 300);
        }, 5000);
    }
    
    // Contact form submission
    function sendEmail(event) {
        event.preventDefault();
        
        const submitBtn = document.getElementById('submitBtn');
        const originalText = submitBtn.textContent;
        
        // Disable button and show loading state
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        
        // Initialize EmailJS with your public key
        emailjs.init("xSYgQUruN6qY2C0o2");
        
        // Check if appointment is requested
        const appointmentRequested = document.getElementById('appointmentToggle').checked;
        let estDateTime = 'No appointment requested';
        
        if (appointmentRequested) {
            const datetimeInput = document.getElementById('datetime').value;
            if (datetimeInput) {
                const selectedDate = new Date(datetimeInput);
                estDateTime = selectedDate.toLocaleString("en-US", {
                    timeZone: "America/New_York",
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                }) + " EST";
            }
        }
        
        const params = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            inquiry_type: 'Cross-Chain Infrastructure Inquiry',
            message: document.getElementById('message').value,
            appointment_requested: appointmentRequested ? 'Yes' : 'No',
            preferred_datetime: estDateTime
        };
        
        // Send email
        emailjs.send("service_gf8ewl9", "template_nad2dyc", params)
            .then(() => {
                if (appointmentRequested) {
                    showAlert("Thanks for your message and appointment request! We'll get back to you within 24 hours with a meeting invite.", 'success');
                } else {
                    showAlert("Thanks for your message! We'll get back to you within 24 hours.", 'success');
                }
                document.getElementById('contactForm').reset();
                document.getElementById('appointmentFields').classList.remove('show');
            })
            .catch((error) => {
                console.error('Error:', error);
                showAlert("Sorry, there was an error sending your message. Please try again.", 'error');
            })
            .finally(() => {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
{% endblock %}